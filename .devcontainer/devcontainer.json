// For format details, see https://aka.ms/devcontainer.json. For config options, see the
// README at: https://github.com/devcontainers/templates/tree/main/src/ubuntu

//extra extensions
// "GitHub.vscode-github-actions",
// "blackgirlbytes.deploy-to-github-pages",
{
    "name": "Ubuntu",
    "image": "mcr.microsoft.com/devcontainers/base:noble",
    "features": {
        "ghcr.io/devcontainers/features/node:1": {}
    },
    "portsAttributes": {
        "7676": {
            "label": "Compute",
            "onAutoForward": "openPreview"
        }
    },
    "updateContentCommand": "npm install",
    "postCreateCommand": "eleventy --serve",
    "postAttachCommand": "if [ ! -d './compute-js' ]; then npx @fastly/compute-js-static-publish@latest --root-dir=./build --kv-store-name=blog-content; fi && cd compute-js && npm install && npm run dev:publish && npx --yes @fastly/cli compute serve --watch", 
    "waitFor": "postCreateCommand",
    "customizations": {
        "vscode": {
            "extensions": [
                "jkearins.action-buttons-ext@0.1.1",
                "esbenp.prettier-vscode",
                "dbaeumer.vscode-eslint"
            ],
            "settings": {
                "files.exclude": {
      			"package-lock.json": true,
			".gitignore": true,
			"node_modules/": true
		},
		"editor.minimap.enabled": false,
		"editor.defaultFormatter": "esbenp.prettier-vscode",
                "actionButtons": {
                    "commands": [
                        {
                            "name": "ðŸª„ Prettify",
                            "singleInstance": true,
                            "useVsCodeApi": true,
                            "command": "editor.action.formatDocument"
                        },
                        {
                            "name": "ðŸ’» Terminal",
                            "singleInstance": true,
                            "useVsCodeApi": true,
                            "command": "workbench.action.terminal.toggleTerminal"
                        },
                        {
                            "name": "ðŸš€ Deploy",
                            "singleInstance": true,
                            "command": "if [ ! $FASTLY_API_TOKEN ]; then echo 'Grab an API key and add it your repo before deploying!'; else npm run fastly:deploy && npm run fastly:publish  --service-name=$CODESPACE_NAME --accept-defaults --auto-yes || echo 'Oops! Something went wrong. ðŸ˜­'; fi"
                        },
            		{
				"name": "ðŸ”Ž Split",
				"singleInstance": true,
				"useVsCodeApi": true,
				"command": "workbench.action.moveEditorToNextGroup"
			}
                    ],
                    "defaultColor": "none"
                }
            }
        }
    }
}
